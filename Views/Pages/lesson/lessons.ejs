<div class="content container-fluid">
  <!-- Page Header -->
  <div class="page-header">
    <div class="row align-items-center">
      <div class="col">
        <h3 class="page-title">Lesson</h3>
        <ul class="breadcrumb">
          <li class="breadcrumb-item"><a href="index">Dashboard</a></li>
          <li class="breadcrumb-item active">Lesson</li>
        </ul>
      </div>
    </div>
  </div>
  <!-- /Page Header -->

  <div class="row">
    <div class="col-sm-12">
      <div class="card card-table">
        <div class="card-body">
          <!-- Page Header -->
          <div class="page-header">
            <div class="row align-items-center">
              <div class="col">
                <h3 class="page-title">List of Lessons</h3>
              </div>
            </div>
          </div>
          <!-- /Page Header -->
          <div class="table-responsive">
            <table class="table border-0 star-student table-hover table-center mb-0 datatable table-striped">
              <thead class="student-thread">
                <tr>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Course Code</th>
                  <th>Lecture</th>
                  <th>Credit Hours</th>
                  <th>Status</th>
                  <th class="">Action</th>
                </tr>
              </thead>
              <tbody>
                <%lessons.forEach(lesson=>{%>
                  <tr id="<%=lesson.id%>" class="add-row">
                    <td>
                      <%=moment(lesson.date).format("LL")%>
                    </td>
                    <td>
                      <%=lesson.time%>
                    </td>
                    <td>
                      <%=lesson.course_code%>
                    </td>
                    <td>
                      <%=lesson.name%>
                    </td>
                    <td>
                      <%=lesson.credit_hours%>
                    </td>
                    <td class="status">
                      <%if(lesson.approval_status=='Pending' ){%>
                        <span class="badge bg-info">
                          <%=lesson.approval_status%>
                        </span>
                        <%} else {%>
                          <span class="badge bg-success">
                            <%=lesson.approval_status%>
                          </span>
                          <%}%>
                    </td>
                    <td class="add-remove">
                      <a data-id="<%=lesson.id%>" class="badge badge-danger approve"
                        style="color:white; cursor: pointer;">Approve</a>
                    </td>
                  </tr>
                  <%})%>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL -->


<!-- SCRIPT -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    let approve = document.querySelectorAll('.approve');
    for (let i = 0; i < approve.length; i++) {
      const element = approve[i]
      element.addEventListener('click', (e) => {
        e.preventDefault()
        fetch('/lesson/' + element.dataset.id, {
          method: "PUT",
          "headers": {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ data: "Upfa" })
        }
        ).then(finalres => {
          if (finalres?.status == 200) {
            Swal.fire({
              title: "Lesson updated Succesfully ðŸ˜€",
              confirmButtonClass: "btn btn-primary",
              buttonsStyling: !1,
            }).then((result) => {
              if (result.isConfirmed) {
                window.location = "/lesson";
              }
            });
          } else {
            Swal.fire({
              title: "Problem updating lesson ",
              confirmButtonClass: "btn btn-primary",
              buttonsStyling: !1,
            })
          }
        }).catch(error => {
          Swal.fire({
            title: "Problem updating lesson ",
            confirmButtonClass: "btn btn-primary",
            buttonsStyling: !1,
          })
        })
      })
    }

  })
</script>